 # Oracle MCP Server Container
FROM registry.access.redhat.com/ubi9/ubi-minimal:latest

# Set labels
LABEL maintainer="Oracle MCP Server"
LABEL description="Oracle MCP Server with SQLcl integration"

# Set environment variables
ENV JAVA_HOME=/usr/lib/jvm/java-17-openjdk
ENV PATH=$JAVA_HOME/bin:$PATH
ENV CLASSPATH=/opt/oracle/sqlcl/lib/*

# Install Java 17 and required packages
RUN microdnf update -y && \
    microdnf install -y java-17-openjdk-headless curl unzip shadow-utils procps ncurses python3 python3-pip && \
    microdnf clean all

# Create oracle user
RUN useradd -r -s /bin/bash oracle && \
    mkdir -p /opt/oracle && \
    chown -R oracle:oracle /opt/oracle

# Switch to oracle user
USER oracle
WORKDIR /opt/oracle

# Download and install Oracle SQLcl
RUN curl -L -o sqlcl-latest.zip https://download.oracle.com/otn_software/java/sqldeveloper/sqlcl-latest.zip && \
    unzip sqlcl-latest.zip && \
    rm sqlcl-latest.zip && \
    chmod +x sqlcl/bin/sql

# Copy MCP server
COPY mcp_server.py /opt/oracle/

# Set permissions
RUN chmod +x /opt/oracle/mcp_server.py

# Expose port for potential debugging
EXPOSE 8080

# Start Oracle MCP Server
CMD ["python3", "/opt/oracle/mcp_server.py"]